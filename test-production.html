<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª Test Production - Emoji Code Mood</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="security-badge" style="background: #28a745; color: white;">
                ğŸš€ Test Production
            </div>
            <h1>ğŸ­ Emoji Code Mood - Test Production</h1>
            <p>Test de l'application en mode production avec Supabase</p>
        </div>
        
        <div class="main-content">
            <div class="form-section">
                <h2>ğŸ“ Test du formulaire complet</h2>
                
                <form id="moodForm">
                    <div class="form-group">
                        <label for="studentName">PrÃ©nom :</label>
                        <input type="text" id="studentName" required placeholder="Test Production" maxlength="30">
                    </div>
                    
                    <div class="form-group">
                        <label>Emoji :</label>
                        <div class="emoji-selector">
                            <button type="button" class="emoji-btn" data-emoji="ğŸš€">ğŸš€</button>
                            <button type="button" class="emoji-btn" data-emoji="ğŸ’»">ğŸ’»</button>
                            <button type="button" class="emoji-btn" data-emoji="ğŸ¯">ğŸ¯</button>
                            <button type="button" class="emoji-btn" data-emoji="ğŸ”¥">ğŸ”¥</button>
                            <button type="button" class="emoji-btn" data-emoji="âœ¨">âœ¨</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="language">Langage :</label>
                        <select id="language" required>
                            <option value="">Choisis</option>
                            <option value="javascript">JavaScript</option>
                            <option value="python">Python</option>
                            <option value="typescript">TypeScript</option>
                            <option value="java">Java</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="comment">Commentaire :</label>
                        <textarea id="comment" placeholder="Test production - Protection anti-doublon" rows="3"></textarea>
                    </div>
                    
                    <button type="submit" id="submitBtn" class="submit-btn">Tester Production ! ğŸš€</button>
                </form>
            </div>
            
            <div class="display-section">
                <h2>ğŸ“Š RÃ©sultats du test</h2>
                <div id="testResults">
                    <p>Cliquez sur "Tester Production !" pour vÃ©rifier le fonctionnement complet</p>
                </div>
                
                <div class="stats-section">
                    <h3>ğŸ“ˆ Statistiques</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">Total participants :</span>
                            <span id="totalParticipants" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">VariÃ©tÃ© d'emojis :</span>
                            <span id="moodVariety" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Temps de session :</span>
                            <span id="sessionTime" class="stat-value">0</span> min
                        </div>
                    </div>
                </div>
                
                <div id="moodList">
                    <h3>ğŸ“ Moods ajoutÃ©s :</h3>
                    <div class="loading">
                        <p>ğŸ¤– En attente des premiers codes mood...</p>
                        <p style="font-size: 0.9em; margin-top: 10px; color: #666;">Synchronisation temps rÃ©el active</p>
                    </div>
                </div>
                
                <div id="moodVisualization">
                    <h3>ğŸ“Š Visualisation des emojis</h3>
                    <div class="visualization-placeholder">
                        <p>Les emojis les plus populaires apparaÃ®tront ici</p>
                    </div>
                </div>
            </div>
            
            <div class="teacher-controls">
                <h3>ğŸ‘¨â€ğŸ« ContrÃ´les Enseignant</h3>
                <div class="control-buttons">
                    <button onclick="window.loadMoods(event)" class="control-btn">ğŸ”„ Actualiser</button>
                    <button onclick="window.exportMoods()" class="control-btn">ğŸ“Š Exporter CSV</button>
                    <button onclick="window.exportMoodsJSON()" class="control-btn">ğŸ“„ Exporter JSON</button>
                    <button onclick="window.clearAllMoods(event)" class="control-btn danger">ğŸ—‘ï¸ Tout effacer</button>
                </div>
            </div>
            
            <div class="production-info">
                <h3>ğŸ”§ Informations de production</h3>
                <div id="productionStatus">
                    <p>VÃ©rification de la configuration...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Configuration privÃ©e (gÃ©nÃ©rÃ©e par GitHub Actions) -->
    <script src="private-config.js"></script>
    
    <!-- BibliothÃ¨que Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script type="module" src="main.js"></script>
    
    <script>
        // Test de production
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ§ª Test de production initialisÃ©');
            
            // VÃ©rifier la configuration
            if (window.PRIVATE_CONFIG) {
                console.log('âœ… Configuration dÃ©tectÃ©e:', {
                    mode: window.PRIVATE_CONFIG.mode,
                    hasUrl: !!window.PRIVATE_CONFIG.supabaseUrl,
                    hasKey: !!window.PRIVATE_CONFIG.supabaseAnonKey
                });
                
                document.getElementById('productionStatus').innerHTML = `
                    <div style="background: #d4edda; padding: 15px; border-radius: 8px; color: #155724;">
                        <h4>âœ… Configuration valide</h4>
                        <p><strong>Mode :</strong> ${window.PRIVATE_CONFIG.mode}</p>
                        <p><strong>Supabase :</strong> ConfigurÃ© et sÃ©curisÃ©</p>
                        <p><strong>DÃ©ploiement :</strong> GitHub Actions</p>
                    </div>
                `;
            } else {
                console.error('âŒ Configuration manquante');
                document.getElementById('productionStatus').innerHTML = `
                    <div style="background: #f8d7da; padding: 15px; border-radius: 8px; color: #721c24;">
                        <h4>âŒ Configuration manquante</h4>
                        <p>VÃ©rifiez que le dÃ©ploiement GitHub Actions s'est bien exÃ©cutÃ©.</p>
                        <p>Consultez <a href="docs/github-actions-setup.md">le guide de configuration</a>.</p>
                    </div>
                `;
            }
            
            // VÃ©rifier que Supabase est chargÃ©
            if (window.supabase) {
                console.log('âœ… BibliothÃ¨que Supabase chargÃ©e');
            } else {
                console.warn('âš ï¸ BibliothÃ¨que Supabase non encore chargÃ©e');
            }
        });
        
        // Fonction de test de la protection anti-doublon
        window.testAntiDuplication = async function() {
            console.log('ğŸ§ª Test de la protection anti-doublon...');
            
            const testMood = {
                name: 'Test Anti-Doublon',
                emoji: 'ğŸ§ª',
                language: 'javascript',
                comment: 'Test de protection en production'
            };
            
            // Premier ajout
            console.log('ğŸ“ Premier ajout...');
            const firstResult = await window.addMood(testMood);
            console.log('Premier rÃ©sultat:', firstResult);
            
            // DeuxiÃ¨me ajout (devrait Ãªtre rejetÃ©)
            console.log('ğŸ“ DeuxiÃ¨me ajout (devrait Ãªtre rejetÃ©)...');
            const secondResult = await window.addMood(testMood);
            console.log('DeuxiÃ¨me rÃ©sultat:', secondResult);
            
            if (firstResult && !secondResult) {
                console.log('âœ… Protection anti-doublon fonctionne !');
                alert('âœ… Test rÃ©ussi : Protection anti-doublon active en production');
            } else {
                console.log('âŒ Protection anti-doublon ne fonctionne pas');
                alert('âŒ Test Ã©chouÃ© : VÃ©rifiez la console');
            }
        };
        
        // Ajouter un bouton de test anti-doublon
        setTimeout(() => {
            const testBtn = document.createElement('button');
            testBtn.textContent = 'ğŸ§ª Tester Anti-Doublon';
            testBtn.onclick = window.testAntiDuplication;
            testBtn.style.cssText = 'background: #17a2b8; color: white; padding: 10px; margin: 10px; border: none; border-radius: 5px; cursor: pointer;';
            document.querySelector('.teacher-controls').appendChild(testBtn);
        }, 2000);
    </script>
</body>
</html>
